// PPO Training Loop
digraph {
	rankdir=TB size="10,14"
	node [fontname=Arial shape=box style="rounded,filled"]
	start [label="Inicjalizacja
ActorCritic (θ₀)" fillcolor=lightblue]
	epoch_check [label="Epoka < 100?" fillcolor=lightyellow shape=diamond]
	rollout_reset [label="FAZA 1: Rollout
Reset środowiska" fillcolor="#ffcdd2"]
	rollout_action [label="Agent: a ~ π_θ(s)" fillcolor="#ffcdd2"]
	rollout_step [label="Środowisko:
s', r ← step(a)" fillcolor="#ffcdd2"]
	rollout_buffer [label="Buffer ← (s,a,r,V)" fillcolor="#ffcdd2"]
	done_check [label="Done?" fillcolor=lightyellow shape=diamond]
	race_check [label="50 wyścigów?" fillcolor=lightyellow shape=diamond]
	gae [label="FAZA 2: GAE
Oblicz δ_t, Â_t" fillcolor="#c8e6c9"]
	ppo_start [label="FAZA 3: PPO Update
10 epok PPO" fillcolor="#b3e5fc"]
	ppo_shuffle [label="Shuffle buffer" fillcolor="#b3e5fc"]
	ppo_batch [label="Mini-batch (64)" fillcolor="#b3e5fc"]
	ppo_forward [label="Forward: π_new, V_new" fillcolor="#b3e5fc"]
	ppo_loss [label="Loss: L^CLIP + L^VF - H" fillcolor="#b3e5fc"]
	ppo_backprop [label="Backprop + Clip grad" fillcolor="#b3e5fc"]
	ppo_check [label="10 epok?" fillcolor=lightyellow shape=diamond]
	save [label="Zapisz model" fillcolor=lightblue]
	end [label=KONIEC fillcolor=lightgreen]
	start -> epoch_check
	epoch_check -> rollout_reset [label=Tak]
	rollout_reset -> rollout_action
	rollout_action -> rollout_step
	rollout_step -> rollout_buffer
	rollout_buffer -> done_check
	done_check -> rollout_action [label=Nie]
	done_check -> race_check [label=Tak]
	race_check -> rollout_reset [label=Nie]
	race_check -> gae [label=Tak]
	gae -> ppo_start
	ppo_start -> ppo_shuffle
	ppo_shuffle -> ppo_batch
	ppo_batch -> ppo_forward
	ppo_forward -> ppo_loss
	ppo_loss -> ppo_backprop
	ppo_backprop -> ppo_check
	ppo_check -> ppo_shuffle [label=Nie]
	ppo_check -> save [label=Tak]
	save -> epoch_check
	epoch_check -> end [label=Nie]
}
